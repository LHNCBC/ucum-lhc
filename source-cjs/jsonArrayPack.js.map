{"version":3,"file":"jsonArrayPack.js","names":["pushFn","Array","prototype","push","isObject","value","Object","toString","call","createConfig","refObj","keys","reduce","config","key","apply","map","keyTail","concat","prepareConfig","isArray","packItem","item","join","Error","keyArr","place","forEach","undefined","unpackItem","result","i","length","packArray","arr","_config","data","bind","unpackArray","obj"],"sources":["../source/jsonArrayPack.js"],"sourcesContent":["/**\n * This file provides functions to reduce the size of an array of objects of the same structure in JSON.\n */\nconst pushFn = Array.prototype.push;\n\nfunction isObject(value) {\n  return Object.prototype.toString.call(value) === '[object Object]';\n}\n\n/**\n * Makes human readable config used to pack/unpack array of objects of the same structure to store with packed data.\n * @param {Object} refObj - reference item of array of objects of the same structure\n * @returns {Array}\n */\nfunction createConfig(refObj) {\n  return Object.keys(refObj).reduce((config, key) => {\n    if (isObject(refObj[key])) {\n      pushFn.apply(config, createConfig(refObj[key]).map(keyTail => [key, ...[].concat(keyTail)]));\n    } else {\n      config.push(key);\n    }\n    return config;\n  }, [])\n}\n\n/**\n * Prepares config created with createConfig function to use in packItem/unpackItem functions.\n * @param {Array} config\n * @returns {Array}\n */\nfunction prepareConfig(config) {\n  return config.map(key => Array.isArray(key) ? key : [key]);\n}\n\n/**\n * Converts an object to an array of values in the order of keys from configuration array.\n * @param {Array} config - configuration array\n * @param {Object} item - input object\n * @returns {Array}\n */\nfunction packItem(config, item) {\n  if (config.join() !== prepareConfig(createConfig(item)).join()) {\n    throw new Error('Object of unusual structure')\n  }\n\n  return config.map(keyArr => {\n    let place = item;\n    keyArr.forEach(key => {\n      place = place[key];\n      if (place === undefined) {\n        throw new Error('Object of unusual structure')\n      }\n    });\n    return place;\n  });\n}\n\n/**\n * Performs the reverse of packItem function.\n * @param {Array} config - configuration array\n * @param {Array} item - input object\n * @returns {Object}\n */\nfunction unpackItem(config, item) {\n  let result = {};\n\n  config.forEach((keyArr, i) => {\n    let place = result;\n    for (let i = 0; i < keyArr.length - 1; i++) {\n      place = place[keyArr[i]] = place[keyArr[i]] || {};\n    }\n    place[keyArr[keyArr.length - 1]] = item[i];\n  });\n\n  return result;\n}\n\n/**\n * Reduces size of an array of objects of the same structure before serialize it to JSON\n * @param {Array} arr\n * @returns {Object}\n */\nexport function packArray(arr) {\n  if (arr && arr.length) {\n    const config = createConfig(arr[0]),\n      _config = prepareConfig(config);\n\n    if (config.length) {\n      return {\n        config: config,\n        data: arr.map(packItem.bind(null, _config))\n      };\n    }\n  }\n\n  return {\n    config: [],\n    data: arr\n  };\n}\n\n/**\n * Restores an array of objects of the same structure after deserializing this object from JSON\n * @param {Object} obj\n * @returns {Array}\n */\nexport function unpackArray(obj) {\n  const config = obj && obj.config;\n\n  if (config) {\n    if (config.length && obj.data) {\n      const _config = prepareConfig(config);\n\n      return obj.data.map(unpackItem.bind(null, _config));\n    } else {\n      return obj.data;\n    }\n  }\n\n  return obj;\n}"],"mappings":"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"}